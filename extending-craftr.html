<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>Extending Craftr</title>
    <link href="static/style.css" rel="stylesheet">
    <link href="static/pygments.css" rel="stylesheet">
  </head>
  <body>
    
    <div class="sidebar">
      
      <div class="logo">
        <img src="static/logo.png">
      </div>
      
      <div class="title">
        <p><a href="index.html">The Craftr build system</a></p>
      </div>
      <hr/>
      <div class="toc">
        
    <ul>
      
      <li><a class="" href="index.html">Home</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="getting-started.html">Getting Started</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="tips.html">Tips & Tricks</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="dsl.html">The Craftr DSL</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl.html">Standard Library</a></li>
      
    <ul>
      
      <li><a class="" >Language Support</a></li>
      
    <ul>
      
      <li><a class="" href="stl/lang/csharp.html">C#</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/cxx.html">C/C++</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/cython.html">Cython</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/haskell.html">Haskell</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/java.html">Java</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/ocaml.html">Ocaml</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/vala.html">Vala</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      
      <li><a class="" >Libraries</a></li>
      
    <ul>
      
      <li><a class="" href="stl/libs/glew.html">GLEW</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/libs/glfw.html">GLFW</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/libs/opencl.html">OpenCL</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/libs/sfml.html">SFML</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      
      <li><a class="" >Tools</a></li>
      
    <ul>
      
      <li><a class="" href="stl/tools/cache.html">Build Cache</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/cmake.html">CMake</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/download.html">Download</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/msvc.html">MSVC</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/pkg-config.html">pkg-config</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/platform-commands.html">Platform Commands</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/batchvars.html">Windows Batch Files</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      
    </ul>
    
      
      <li><a class="active" href="extending-craftr.html">Extending Craftr</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      </div>
      
      <hr/>
      <div class="statigen-notice">Built with <a href="https://github.com/NiklasRosenstein/statigen">statigen</a>.</div>
    </div>
    <div class="content">
      <div class="content-inner">
        
          <h1>Extending Craftr</h1>
        
        <p>A module that is imported can register a <code>TargetHandler</code> to the Craftr build
context. This TargetHandler can then register properties to the module, target
and dependency blocks and gets a chance to read the property values to turn
them into build actions.</p>
<p>The TargetHandler can be implemented in the build script itself or in another
Python script that you can <code>import</code>. Note that you will need to import that
Craftr build context from the build script.</p>
<table>
<tr><th>Inline
</th><th>Separate
</th></tr>
<tr><td><div class="highlight"><pre><span></span><span class="c1"># java/build.craftr</span>
<span class="n">project</span> <span class="s2">"java"</span> <span class="n">v1</span><span class="o">.</span><span class="mf">0.0</span>
<span class="nb">eval</span><span class="p">:</span><span class="o">&gt;&gt;</span>

<span class="kn">import</span> <span class="nn">craftr</span> <span class="nn">from</span> <span class="s1">'craftr.craftr'</span>

<span class="k">class</span> <span class="nc">JavaTargetHandler</span><span class="p">(</span><span class="n">craftr</span><span class="o">.</span><span class="n">TargetHandler</span><span class="p">):</span>
  <span class="c1"># ...</span>
</pre></div>
</td><td><div class="highlight"><pre><span></span><span class="c1"># java/build.craftr</span>
<span class="n">project</span> <span class="s2">"java"</span> <span class="n">v1</span><span class="o">.</span><span class="mf">0.0</span>
<span class="kn">import</span> <span class="s2">"./targethandler"</span>

<span class="c1"># java/targethandler.py</span>
<span class="kn">import</span> <span class="nn">craftr</span><span class="o">,</span> <span class="p">{</span><span class="n">context</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">'craftr.craftr'</span>

<span class="k">class</span> <span class="nc">JavaTargetHandler</span><span class="p">(</span><span class="n">craftr</span><span class="o">.</span><span class="n">TargetHandler</span><span class="p">):</span>
  <span class="c1"># ...</span>
</pre></div>
</td></tr>
</table><p>A target handler must be registered with <code>context.register_handler()</code>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">craftr</span><span class="o">,</span> <span class="p">{</span><span class="n">context</span><span class="p">,</span> <span class="n">path</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">'craftr.craftr'</span>

<span class="k">class</span> <span class="nc">JavaTargetHandler</span><span class="p">(</span><span class="n">craftr</span><span class="o">.</span><span class="n">TargetHandler</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">target_properties</span>
    <span class="n">props</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">'java.srcs'</span><span class="p">,</span> <span class="n">craftr</span><span class="o">.</span><span class="n">StringList</span><span class="p">)</span>
    <span class="c1"># ...</span>
  
  <span class="k">def</span> <span class="nf">translate_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="s1">'java.'</span><span class="p">,</span> <span class="n">as_object</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">srcs</span><span class="p">:</span>
      <span class="c1"># Generate a build action to compile the Java source files.</span>
      <span class="n">data</span><span class="o">.</span><span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">srcs</span><span class="p">]</span>
      <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">setsuffix</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">'.class'</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">srcs</span><span class="p">]</span>
      <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'javac'</span><span class="p">,</span> <span class="s1">'${in}'</span><span class="p">]</span>
      <span class="n">action</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="s1">'java.javac'</span><span class="p">,</span> <span class="n">commands</span><span class="o">=</span><span class="p">[</span><span class="n">command</span><span class="p">])</span>
      <span class="n">buildset</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">add_buildset</span><span class="p">()</span>
      <span class="n">buildset</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">srcs</span><span class="p">,</span> <span class="p">[</span><span class="s1">'in'</span><span class="p">])</span>
      <span class="n">buildset</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="p">[</span><span class="s1">'out'</span><span class="p">,</span> <span class="s1">'java.class'</span><span class="p">])</span>

<span class="n">context</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="n">JavaTargetHandler</span><span class="p">())</span>
</pre></div>
<p>Make sure you tag the output files of an action appropriately, as other
targets can use it to access these files and create further build actions
with them.</p>

      </div>
    </div>
  </body>
</html>