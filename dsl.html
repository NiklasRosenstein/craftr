<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>The Craftr DSL</title>
    <link href="static/style.css" rel="stylesheet">
    <link href="static/pygments.css" rel="stylesheet">
  </head>
  <body>
    
    <div class="sidebar">
      
      <div class="logo">
        <img src="static/logo.png">
      </div>
      
      <div class="title">
        <p><a href="index.html">The Craftr build system</a></p>
      </div>
      <hr/>
      <div class="toc">
        
    <ul>
      
      <li><a class="" href="index.html">Home</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="getting-started.html">Getting Started</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="tips.html">Tips & Tricks</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="active" href="dsl.html">The Craftr DSL</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl.html">Standard Library</a></li>
      
    <ul>
      
      <li><a class="" >Language Support</a></li>
      
    <ul>
      
      <li><a class="" href="stl/lang/csharp.html">C#</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/cxx.html">C/C++</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/cython.html">Cython</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/haskell.html">Haskell</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/java.html">Java</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/ocaml.html">Ocaml</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/lang/vala.html">Vala</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      
      <li><a class="" >Libraries</a></li>
      
    <ul>
      
      <li><a class="" href="stl/libs/glew.html">GLEW</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/libs/glfw.html">GLFW</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/libs/opencl.html">OpenCL</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/libs/sfml.html">SFML</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      
      <li><a class="" >Tools</a></li>
      
    <ul>
      
      <li><a class="" href="stl/tools/cache.html">Build Cache</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/cmake.html">CMake</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/download.html">Download</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/msvc.html">MSVC</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/pkg-config.html">pkg-config</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/platform-commands.html">Platform Commands</a></li>
      
    <ul>
      
    </ul>
    
      
      <li><a class="" href="stl/tools/batchvars.html">Windows Batch Files</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      
    </ul>
    
      
      <li><a class="" href="extending-craftr.html">Extending Craftr</a></li>
      
    <ul>
      
    </ul>
    
      
    </ul>
    
      </div>
      
      <hr/>
      <div class="statigen-notice">Built with <a href="https://github.com/NiklasRosenstein/statigen">statigen</a>.</div>
    </div>
    <div class="content">
      <div class="content-inner">
        
          <h1>The Craftr DSL</h1>
        
        <h2>Introduction</h2>
<p>Craftr uses its own language to allow you to define build targets. The goal
of this language is to have a flexible and expressive and yet powerful syntax
for describing build information.</p>
<p>The DSL allows you to write inline-Python code, and every property that you
assign on the module, target or dependency level is evaluated as a full Python
expression. The Python used by Craftr has some additional features regarding
built-in variables and syntax.</p>
<p>Importing other build scripts or Python scripts can be done using the [Node.py]
module import syntax, for example:</p>
<div class="highlight"><pre><span></span><span class="n">project</span> <span class="s2">"myproject"</span>
<span class="kn">import</span> <span class="s2">"craftr/lang/java"</span>
<span class="kn">import</span> <span class="nn">utils</span> <span class="nn">from</span> <span class="s2">"./utils"</span>
</pre></div>
<p>Importing other Craftr build scripts always require the <code>.craftr</code> suffix. Once
another Craftr module is imported, it is part of the build process.</p>
<p>The standard library provides a bunch of modules that implement build support
for various programming languages. Once such a module is imported, properties
that are supported by that module can be set on modules and dependencies, but
most of the time on targets.</p>
<div class="highlight"><pre><span></span><span class="n">project</span> <span class="s2">"myproject"</span>
<span class="kn">import</span> <span class="s2">"craftr/lang/java"</span>
<span class="n">target</span> <span class="s2">"main"</span><span class="p">:</span>
  <span class="n">java</span><span class="o">.</span><span class="n">srcs</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">'src/**/*.java'</span><span class="p">)</span>
</pre></div>
<h2>Syntax Documentation</h2>
<p>A build script consists of statements and blocks, and most blocks have their
own inner grammar. Not all blocks can be nested inside each other.</p>
<h3>Example</h3>
<div class="highlight"><pre><span></span><span class="n">project</span> <span class="s2">"myproject"</span> <span class="n">v1</span><span class="o">.</span><span class="mf">6.4</span>

<span class="c1"># Make another directory that contains a Craftr build module available to this</span>
<span class="c1"># and all other modules that depends on this module. This is similar to using</span>
<span class="c1"># the `craftr --link` option.</span>
<span class="n">link_module</span> <span class="s2">"./vendor/mycompany/subproject"</span>

<span class="c1"># A block of TOML formatted configuration values. These are applied only</span>
<span class="c1"># when your build script is the builds' entry point.</span>
<span class="n">configure</span><span class="p">:</span>
  <span class="p">[</span><span class="n">myproject</span><span class="p">]</span>
  <span class="n">option1</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># A block of options expected by the module. Options without default value</span>
<span class="c1"># must be set, otherwise there will be an error. The options are made available</span>
<span class="c1"># as an object called "objects" in the global namespace of the module.</span>
<span class="n">options</span><span class="p">:</span>
  <span class="nb">int</span> <span class="n">option1</span>
  <span class="nb">str</span> <span class="n">option2</span> <span class="o">=</span> <span class="s2">"Hello, World"</span>
  <span class="nb">bool</span> <span class="n">option3</span> <span class="o">=</span> <span class="bp">False</span>

<span class="nb">eval</span> <span class="k">print</span><span class="p">(</span><span class="s1">'This is a single line of Python code! option2:'</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">option2</span><span class="p">)</span>

<span class="c1"># A block of Node.py-processed Python code.</span>
<span class="nb">eval</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s1">'This is a block of Python code!'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s1">'The options you chose are:'</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">option1</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">option2</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">option3</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s1">'You are on'</span><span class="p">,</span> <span class="n">OSNAME</span><span class="p">)</span>
  <span class="n">includes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'./include'</span><span class="p">]</span>

<span class="c1"># An import-line, the same can be put inside an eval: block.</span>
<span class="c1"># Allows you to import other Craftr build modules, Python or Node.py modules.</span>
<span class="kn">import</span> <span class="s2">"craftr/lang/cxx"</span>

<span class="c1"># Declare a pool where targets can be assigned to.</span>
<span class="n">pool</span> <span class="s2">"myPool"</span> <span class="mi">4</span>

<span class="c1"># Declare a public target. Exported targets are publicly visible and</span>
<span class="c1"># automatically depended on when declaring a dependency to the module in</span>
<span class="c1"># another target.</span>
<span class="n">public</span> <span class="n">target</span> <span class="s2">"lib"</span><span class="p">:</span>

  <span class="c1"># Declare an exported dependency to the module "libcurl.craftr".</span>
  <span class="c1"># Exported dependencies are inherited transitively by other targets.</span>
  <span class="n">export</span> <span class="n">requires</span> <span class="s2">"libcurl"</span><span class="p">:</span>
    <span class="n">cxx</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># That's the default</span>

  <span class="c1"># Assign the target to a pool. Note that this may not always be respected</span>
  <span class="c1"># by the target build handler.</span>
  <span class="n">this</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="s2">"myPool"</span>

  <span class="c1"># Set property values -- note that these properties can only be set because</span>
  <span class="c1"># the "cxx.craftr" module was imported previously.</span>
  <span class="n">cxx</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">'library'</span>
  <span class="n">cxx</span><span class="o">.</span><span class="n">srcs</span> <span class="o">=</span> <span class="n">glob</span><span class="p">([</span><span class="s1">'./src/*.cpp'</span><span class="p">,</span> <span class="s1">'./src/'</span> <span class="o">+</span> <span class="n">OSNAME</span> <span class="o">+</span> <span class="s1">'/*.cpp'</span><span class="p">],</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'./src/main.cpp'</span><span class="p">])</span>

  <span class="c1"># Exported properties CAN be inherited transitively by targets that</span>
  <span class="c1"># depend on this target. Whether the information is considered is up</span>
  <span class="c1"># to the target handler implementation.</span>
  <span class="n">export</span> <span class="n">cxx</span><span class="o">.</span><span class="n">includePaths</span> <span class="o">=</span> <span class="n">includes</span>
  <span class="n">export</span><span class="p">:</span>
    <span class="n">cxx</span><span class="o">.</span><span class="n">includePaths</span> <span class="o">=</span> <span class="n">includes</span>

<span class="c1"># Declare a non-public target. Can still be explicity depended on using</span>
<span class="c1"># `requires "myproject@main"`.</span>
<span class="n">target</span> <span class="s2">"main"</span><span class="p">:</span>
  <span class="n">requires</span> <span class="s2">"@lib"</span>
  <span class="c1"># Assign the module of the dependency to a variable, saves you a separate</span>
  <span class="c1"># import ... from ... statement of the same module.</span>
  <span class="n">requires</span> <span class="s2">"SomeCompany/somelibrary"</span> <span class="k">as</span> <span class="n">somelib</span>
  <span class="n">cxx</span><span class="o">.</span><span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'./src/main.cpp'</span><span class="p">]</span> <span class="o">+</span> <span class="n">somelib</span><span class="o">.</span><span class="n">inline_srcs</span>
</pre></div>
<h2>Conditional Blocks</h2>
<p>The following blocks can be made condition by appending a Python <code>if ...</code>
statement</p>
<ul>
<li>export</li>
<li>eval</li>
<li>target</li>
<li>requires</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="n">project</span> <span class="s2">"sfml"</span>
<span class="kn">import</span> <span class="s2">"craftr/lang/cxx"</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">pkg_config</span><span class="p">}</span> <span class="kn">from</span> <span class="s2">"craftr/tools/pkg-config"</span>
<span class="nb">eval</span> <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"This gets never executed"</span><span class="p">)</span>
<span class="n">target</span> <span class="s2">"sfml"</span> <span class="k">if</span> <span class="n">OS</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="s1">'win32'</span><span class="p">:</span>
  <span class="n">requires</span> <span class="s2">"somelib"</span> <span class="k">if</span> <span class="n">some_condition</span><span class="p">:</span>
    <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"here"</span>
  <span class="n">requires</span> <span class="s2">"anotherlib"</span> <span class="k">if</span> <span class="n">another_condition</span>
  <span class="nb">eval</span> <span class="n">pkg_config</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">'SFML-all'</span><span class="p">)</span>
<span class="n">target</span> <span class="s2">"sfml"</span> <span class="k">if</span> <span class="n">OS</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">'win32'</span><span class="p">:</span>
  <span class="n">cxx</span><span class="o">.</span><span class="n">includes</span> <span class="o">=</span> <span class="o">...</span>
  <span class="c1"># etc etc</span>
</pre></div>
<h2>Target Properties</h2>
<p>Target blocks have a set of default properties.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>this.pool</code></td>
<td>str</td>
<td>The name of a job pool to execute the target in. Note that some target handlers may provide their own properties to override the pool for certain parts of the build.</td>
</tr>
<tr>
<td><code>this.syncio</code></td>
<td>bool</td>
<td>Synchronize the standard input/output of commands executed by the target with the console. This does not pair with the <code>pool</code> option.</td>
</tr>
<tr>
<td><code>this.explicit</code></td>
<td>bool</td>
<td>Do not build this target unless it is required by another target or it is explicitly specified on the command-line.</td>
</tr>
<tr>
<td><code>this.directory</code></td>
<td>str</td>
<td>The directory to consider relative paths relative to. A relative path will still be considered relative to the original path.</td>
</tr>
</tbody>
</table>
<h2>Built-in variables</h2>
<p>These variables are available inside Craftr build scripts – not in normal
Node.py/Python scripts.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td>module</td>
<td>The <code>nr.path</code> module – available for convenience.</td>
</tr>
<tr>
<td><code>options</code></td>
<td><code>ModuleOptions</code></td>
<td>A <code>ModuleOptions</code> object. This will be filled with the actual option values after the first <code>options:</code> block. You can use this in an <code>eval:</code> block before the first <code>options:</code> block to initialize default values.</td>
</tr>
<tr>
<td><code>OS</code></td>
<td><code>OsInfo</code></td>
<td>An <code>OsInfo</code> object that contains the name, id, type and arch of the current operating system. Possible names are <code>windows</code>, <code>macos</code> and <code>linux</code>. Possible IDs are <code>win32</code>, <code>darwin</code> and <code>linux</code>. Possible types are <code>nt</code> and <code>posix</code>. Note that on Windows Cygwin, the type will also be <code>posix</code>.  Possible architectures are <code>x86_64</code> and <code>x86</code>.</td>
</tr>
<tr>
<td><code>BUILD</code></td>
<td><code>BuildInfo</code></td>
<td>A <code>BuildInfo</code> object that tells you whether this is a release or debug build. Members of this object are <code>mode</code>, <code>debug</code> and <code>release</code>.</td>
</tr>
<tr>
<td><code>error(message)</code></td>
<td>function</td>
<td>Raise an error (<code>craftr.dsl.ExplicitRunError</code>) with the specified message.</td>
</tr>
<tr>
<td><code>fmt(format)</code></td>
<td>function</td>
<td>Expects a Python <code>str.format()</code> string that will be substituted in the context of the current global and local variables.</td>
</tr>
<tr>
<td><code>glob(patterns, excludes=[], parent=None)</code></td>
<td>function</td>
<td>Match glob patterns relative to <code>parent</code>. If <code>parent</code> is omitted, defaults to directory of the build script or the target if explicitly set with <code>this.directory</code>.</td>
</tr>
</tbody>
</table>

      </div>
    </div>
  </body>
</html>